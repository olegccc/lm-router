!function(a,b){"function"==typeof define&&define.amd?define(["angular"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("angular")):b(angular)}(this,function(a){var b=function(){function a(){}return a}(),c=function(){function c(a,b,c){this.rootPath=a,this.matches=[],this.path=null,this.pageProperties={},this.rootScope=c,this.initializeBrowser(b,c)}return c.prototype.getCurrentPath=function(){var a=location.pathname;return a.substr(0,this.rootPath.length)!=this.rootPath||this.rootPath.length!==a.length&&"/"!=a[this.rootPath.length]||(a=a.substr(this.rootPath.length)),a+location.search},c.prototype.initializeBrowser=function(b,c){var d=this,e=b.url();b.url=function(){return e};var f=function(){var a=d.getCurrentPath();c.$apply(function(){d.onRouteChanged(a)})};a.element(window).on("popstate",f),a.element(window).on("pushstate",f)},c.prototype.on=function(a,c,d,e){void 0===d&&(d=null),void 0===e&&(e=null),this.off(a);var f=new b;f.name=d||"undefined",f.match=a,f.expression=new RegExp("^"+a+"$"),f.instance=e||window,f.handler=c,this.matches.push(f)},c.prototype.off=function(a){for(var b=0;b<this.matches.length;b++){var c=this.matches[b];if(c.match===a){this.matches=this.matches.splice(b,1);break}}},c.prototype.start=function(){this.onRouteChanged(this.getCurrentPath())},c.prototype.loadProperties=function(a){this.pageProperties={};for(var b=a.split("&"),c=0;c<b.length;c++)if(0!==b[c].length){var d=b[c].split("="),e=d[0];this.pageProperties[e]=d.length>0?d[1]:""}},c.prototype.getPathWithQuery=function(){var a="";for(var b in this.pageProperties)if(this.pageProperties.hasOwnProperty(b)){var c=this.pageProperties[b];null!==c&&0!=c.length&&(a.length>0&&(a+="&"),a+=b+"="+c)}var d=this.path||"";return"/"==d[d.length-1]&&(d=d.substring(0,d.length-1)),a.length>0&&(d+="?"+a),d},c.prototype.setPageHistory=function(a){void 0===a&&(a="");var b=this.rootPath+this.getPathWithQuery();window.location.href!=b&&(history.pushState(b,a,b),this.onRouteChanged(b))},c.prototype.navigate=function(a,b){void 0===b&&(b=""),this.path=a,this.pageProperties={},this.setPageHistory(b)},c.prototype.getProperty=function(a,b){return void 0===b&&(b=void 0),this.pageProperties.hasOwnProperty(a)?this.pageProperties[a]:b},c.prototype.setProperty=function(a,b,c){void 0===c&&(c=""),this.pageProperties[a]=b,this.setPageHistory(c),this.rootScope.$$phase||this.rootScope.$apply()},c.prototype.onRouteChanged=function(a){if(this.getPathWithQuery()!==a){var b=a.indexOf("?"),c="";b>0&&(c=a.substr(b+1),a=a.substring(0,b)),this.loadProperties(c),this.path=a;for(var d=0;d<this.matches.length;d++){var e=this.matches[d],f=e.expression.exec(a);if(f&&f.length>0)return void e.handler.call(e.instance,f.slice(1),this.pageProperties)}console.log("Warning: route '"+a+"' has no handler")}},c}(),d=function(){function a(){var a=this;this.$get=["$browser","$rootScope",function(b,d){return new c(a.rootPath,b,d)}],this.rootPath="/"}return a.prototype.setRootPath=function(a){this.rootPath=a,(0===this.rootPath.length||"/"!=this.rootPath[0])&&(this.rootPath="/"+this.rootPath),"/"===this.rootPath[this.rootPath.length-1]&&(this.rootPath=this.rootPath.substring(0,this.rootPath.length-1))},a}(),e=a.module("lm-router",[]);e.provider("router",[d])});